---
description: Sentry error monitoring and performance tracing patterns
globs:
  - "**/*.ts"
  - "**/*.tsx"
alwaysApply: true
---

# ðŸ”´ Sentry - Error Monitoring & Tracing

**GOAL:** Track errors and performance in production.

**References:**
- Sentry React: https://docs.sentry.io/platforms/javascript/guides/react/
- Performance Monitoring: https://docs.sentry.io/product/performance/

---

## Performance Tracing

### Automatic Tracing

Page loads and navigation are automatically traced via `browserTracingIntegration()`.

### Custom Spans for UI Actions

```typescript
import * as Sentry from "@sentry/react";

function handleButtonClick() {
  Sentry.startSpan(
    {
      op: "ui.click",
      name: "Submit Assignment",
    },
    () => {
      // Your logic here
      processAssignment();
    }
  );
}
```

### Custom Spans for API Calls

```typescript
import * as Sentry from "@sentry/react";

async function fetchStudentData(studentId: string) {
  return Sentry.startSpan(
    {
      op: "http.client",
      name: `GET /api/students/${studentId}`,
    },
    async () => {
      const response = await fetch(`/api/students/${studentId}`);
      return response.json();
    }
  );
}
```

---

## Structured Logging

### Usage

```typescript
import * as Sentry from "@sentry/react";

const { logger } = Sentry;

// Different log levels
logger.info("User logged in", { userId: "123" });
logger.warn("Rate limit approaching", { remaining: 10 });
logger.error("Payment failed", { orderId: "order_456", amount: 99.99 });
```

### With Template Literals

```typescript
const { logger } = Sentry;

logger.debug(logger.fmt`Cache miss for user: ${userId}`);
logger.info(logger.fmt`Assignment ${assignmentId} submitted by ${studentName}`);
```

---

## Best Practices

1. **Never hardcode DSN** - Always use `import.meta.env.VITE_SENTRY_DSN`
2. **Use meaningful span names** - e.g., "Submit Assignment" not "button click"
3. **Add context to errors** - Include relevant data like user ID, assignment ID
4. **Keep sample rates low in production** - `tracesSampleRate: 0.1` (10%)
5. **Use ErrorBoundary** - Wrap app with `Sentry.ErrorBoundary` for React errors

---

## âœ… Sentry Checklist

Before deploying:

- [ ] DSN configured from environment variable
- [ ] ErrorBoundary wrapping main App
- [ ] Meaningful span names for custom traces
- [ ] Sample rate configured appropriately
- [ ] User context set after authentication
